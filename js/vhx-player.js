var VHX=VHX||{};VHX.Player=function(){var e=this;return e.errors={GENERIC:"Sorry, there was an error loading this video. Please try reloading the page.",PLAYBACK:"Sorry, there was an unexpected error with playback. Please try reloading the page.",UNSUPPORTED:'Sorry, your browser is out of date. Please update your browser to the latest version of <a href="http://www.google.com/chrome" target="_blank">Chrome</a>, <a href="http://www.firefox.com" target="_blank">Firefox</a>, <a href="http://support.apple.com/downloads/safari" target="_blank">Safari (6+)</a>, or <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie" target="_blank">IE (9+)</a>.',DRM:'Sorry, to play this video you need to <a href="https://get.adobe.com/flashplayer" target="_top">install Adobe Flash</a>. Alternatively, you can watch on the VHX <a href="https://www.vhx.tv/ios">iPhone</a> or <a href="https://www.roku.com/channels#!details/48061/vhx">Roku</a> app.',DRM_ANDROID:'Sorry, to play this video you need to <a href="https://get.adobe.com/flashplayer" target="_top">install Adobe Flash</a>. Alternatively, you can watch on the VHX <a href="https://www.roku.com/channels#!details/48061/vhx">Roku</a> app.'},e.techs={HTML5:"html5",FLASH:"flash",DASH:"dasheverywhere",VIMEO:"vimeo",YOUTUBE:"youtube"},e.options={techOrder:[e.techs.HTML5,e.techs.FLASH],inactivityTimeout:2500,children:{controlBar:{children:{muteToggle:!1,volumeControl:!1,timeDivider:!1,durationDisplay:!1,volumeMenuButton:{volumeBar:{vertical:!0}}}}}},e.init=function(t,r){return e.options.id=t,e.$container=$("[data-id="+t+"]"),e.$body=$(document.body),e.api=new VHX.Player.Api(e),e.browser=VHX.Player.Utils.getBrowserInfo(),"undefined"!=typeof videojs&&(e.options=videojs.util.mergeOptions(e.options,r),e.options.video_html='<video id="'+e.options.id+'" class="video-js vjs-default-skin" controls crossorigin="anonymous" preload="auto" x-webkit-airplay="allow">',e.options.widget=new VHX.Player.BuyWidget,e.options.api=e.api,(Modernizr.ios||Modernizr.android)&&(e.options.autoplay=!1,e.options.nativeControlsForTouch=!0),e.initSource()),e.api},e.initSource=function(){e.options.autoplay&&e.showSpinner(),e.source=new VHX.Player.Source,e.source.init(e.options,e.onSourceReady)},e.onSourceReady=function(t){t&&t.getVideo()&&(e.options.$video=t.getVideo(),(t.isVimeo()||t.isYoutube())&&(e.options.techOrder.unshift(t.isVimeo()?e.techs.VIMEO:e.techs.YOUTUBE),e.options.src=t.getSource(),e.options.plugins.chromecast={enabled:!1},e.options.children.loadingSpinner=!1),t.isDrmEnabled()&&e.initDRM()),e.initPlayer()},e.initDRM=function(){e.drm=new VHX.Player.DRM(e.options),e.options.dasheverywhere=e.drm.getConfig(),e.options.techOrder.unshift(e.techs.DASH),e.options.plugins.chromecast={enabled:!1}},e.initPlayer=function(){if(e.$body.addClass("init"),e.source.hasError()||e.drm&&!e.drm.isEnabled())return e.setError(e.errors.GENERIC);if(e.initColor(),!e.options.autoplay)return e.initPoster();e.$container.html(e.options.$video),e.runShims();try{e.videojs=videojs(e.options.$video.attr("id"),e.options,function(){e.videojs=this,e.onReady()}),Modernizr.touch&&e.hideSpinner(),e.videojs.on("firstplay",e.hideSpinner),e.videojs.on("playerready",e.onReady)}catch(t){e.onPlayerError(t)}},e.onReady=function(){e.api.ready(),e.videojs.on("error",e.onPlayerError),(!$.support.cors||window.XDomainRequest)&&e.videojs.on("loadedmetadata",function(){e.videojs.currentTime(1)});try{window.localStorage.vhx_cast_progress&&e.videojs.on("timeupdate",e.startFromLocalStorage)}catch(t){}},e.startFromLocalStorage=function(){e.videojs.off("timeupdate",e.startFromLocalStorage);try{window.localStorage.removeItem("vhx_cast_progress"),e.videojs.currentTime(window.localStorage.vhx_cast_progress)}catch(t){}player.play()},e.onPlayerError=function(t){if(t&&"NO_SUPPORTED_PLAYBACK_TECHNOLOGY"===t.message)return e.setError(Modernizr.android?e.errors.DRM_ANDROID:e.errors.DRM);if(e.videojs.error())switch(e.videojs.error().code){case 1:return;case 2:case 3:return e.setError("MANIFEST_LOAD_ERROR"===e.videojs.error().subtype?e.errors.GENERIC:e.errors.PLAYBACK);case 4:return document.createElement("video").canPlayType?e.setError(e.errors.GENERIC):e.setError(e.errors.UNSUPPORTED);default:return e.setError(e.errors.GENERIC)}},e.setError=function(t){return e.hideSpinner(),e.addCanvas("error").empty().append($("<p>").html(t)),e.api.trigger("error",[t]),!0},e.showSpinner=function(){e.$body.append('<div class="vjs-loading-spinner faux-spinner"></div>').hide().fadeIn(100),e.$body.addClass("init")},e.hideSpinner=function(){$(".faux-spinner").remove()},e.initColor=function(){var t=new VHX.Player.SiteColor({color:e.source.getData("color")||"#22b9b0"});e.options.color=t.hex,e.options.$video&&!t.lumonisity_pass&&(e.options.color="#22b9b0")},e.initPoster=function(){var t=parseInt(VHX.Player.Utils.getQueryParam("branding")),r=VHX.Player.Utils.trackingQueryString();return e.poster=e.addCanvas("poster"),e.poster.append('<footer class="poster-footer" '+(e.source.getData("poster-blurred")&&e.source.getData("poster-blurred").length?'style="background-image: url('+e.source.getData("poster-blurred")+');"':"")+'><button class="poster-item poster-item-left poster-play-control"></button>'+(0!==parseInt(VHX.Player.Utils.getQueryParam("title"))&&e.source.getData("title")?'<div class="poster-item poster-item-left poster-title"><a href="'+e.source.getData("homepage")+r+'" target="_blank">'+e.source.getData("title")+"</a></div>":"")+'<a href="https://www.vhx.tv" target="_blank" class="poster-item poster-item-right poster-vhx-link">VHX</a></footer>'),e.source.getData("poster")?e.poster.css("background-image","url("+e.source.getData("poster")+")"):e.source.isYoutube()&&videojs.Youtube.prototype.loadThumbnailUrl(VHX.Player.Utils.getYoutubeVideoId(e.source.getSource()),function(t){e.poster.css("background-image","url("+t+")")}),e.source.getData("purchase-href")&&0!==parseInt(VHX.Player.Utils.getQueryParam("buy_btn"))&&e.poster.append('<div class="vjs-vhx-bar vjs-control-bar"><div class="vjs-vhx-bar-button vjs-vhx-bar-left"><a class="vjs-btn" href="'+e.source.getData("purchase-href")+r+'" target="_blank">'+e.source.getData("purchase-label")+" "+e.source.getData("purchase-price")+"</a></div></div>"),e.source.isTrailerWithoutVideo()?$("html").addClass("no-trailer"):(e.source.isTrailer()&&0!=t||$(".poster-vhx-link").hide(),e.poster.css("cursor","pointer").on("click",function(t){return t.target.getAttribute("target")?void($(t.target).hasClass("vjs-btn")&&e.options.widget.isEnabled()&&(t.preventDefault(),e.options.widget.open($(t.target).prop("href")))):e.handlePlayRequest()}),void e.api.trigger("posterready",[]))},e.handlePlayRequest=function(){var t=function(){e.showSpinner(),e.options.autoplay=!0,e.source.load(e.onSourceReady)};e.poster&&e.poster.length&&e.poster.fadeOut(250,function(){$(this).remove()}),e.source&&e.options.credentials.access_token?t():VHX.Player.authCallback=t},e.addCanvas=function(t){return 0===$("."+t).length&&e.$body.append('<div class="'+t+'"></div>'),$("."+t)},e.hasErrors=function(){return e.source.hasError()||e.drm&&!e.drm.hasValidCredentials()?e.setError(e.errors.GENERIC):e.drm&&!e.drm.isEnabled()?e.setError(Modernizr.android?e.errors.DRM_ANDROID:e.errors.DRM):!1},e.runShims=function(){if(!e.source.isVimeo()&&!e.source.isYoutube()){Modernizr.hls||(videojs.Flash.formats["application/x-mpegurl"]="M3U8");var t=e.browser.name.indexOf("IE")>=0;"Safari"===e.browser.name&&(e.browser.version<6?(0===e.options.$video.find('source[type="video/mp4"]').length&&(videojs.Flash.formats["application/x-mpegurl"]="M3U8"),t=!0):e.browser.version<8&&0===e.options.$video.find('source[type="application/x-mpegURL"]').length&&(t=!0)),t===!0&&(e.options.techOrder=e.options.techOrder.reverse());try{window.localStorage.vhx_cast_progress&&(e.options.autoplay=!1)}catch(r){}}},e.init.apply(e,arguments)};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.Utils={isObject:function(e){return e===Object(e)},isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},getQueryParam:function(e){var t=window.location.search.replace("?",""),r=t.substr(t.indexOf(e+"=")).split("&")[0].split("=")[1];return"undefined"!=typeof r?("/"===r.substr(-1)&&(r=r.substr(0,r.length-1)),decodeURIComponent(r)):null},getYoutubeVideoId:function(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,r=e.match(t);return r&&11===r[2].length?r[2]:null},trackingQueryString:function(){var e=[],t="",r=this.getQueryParam("affiliate"),o=this.getQueryParam("campaign"),a=this.getQueryParam("referrer")||document.referrer;return r&&e.push({key:"affiliate",val:encodeURIComponent(r)}),o&&e.push({key:"campaign",val:encodeURIComponent(o)}),a&&e.push({key:"referrer",val:encodeURIComponent(a)}),$.each(e,function(e,r){t+=0===e?"?"+r.key+"="+r.val:"&"+r.key+"="+r.val}),t},createLinkParser:function(e){var t=document.createElement("a");return e?(t.href=e,t.origin||(t.origin=t.protocol+"//"+t.hostname),t):!1},parseParams:function(e){var t=[];return this.isObject(e)&&$.each(e,function(e,r){t.push(r)}),t},stringifyParams:function(e){var t={};return this.isObject(e)&&$.each(e,function(e,r){t[e]=r}),t},isSubObj:function(e){var t,r=!1;for(t in e)e.hasOwnProperty(t)&&"object"==typeof e[t]&&(r=!0);return r},isPlayerUrl:function(e){var t=["player.vhx.tv","player.crystal.dev"],r=this.createLinkParser(e);return-1!==r.host.indexOf(t)},getHexBrightness:function(e){var t=e.replace(/#/g,""),r=parseInt(t.substr(0,2),16),o=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16),n=(299*r+587*o+114*a)/1e3;return n>150?"light":n>100&&150>=n?"mid":n>35&&100>=n?"mid-dark":"dark"},getBrowserInfo:function(){var e,t="unkown",r=navigator.userAgent,o=r.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(r)||[],{name:"IE",version:e[1]||""}):"Chrome"===o[1]&&(e=r.match(/\bOPR\/(\d+)/),null!==e)?{name:"Opera",version:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=r.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),-1!=navigator.appVersion.indexOf("Win")&&(t="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(t="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(t="Unix"),-1!=navigator.appVersion.indexOf("Linux")&&(t="Linux"),{os:t,name:o[0],version:parseInt(o[1])})}};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.Api=function(){var e=this;return e.public_methods={},e.utils=VHX.Player.Utils,e.EVENTS=["ended","firstplay","fullscreenchange","loadedalldata","loadeddata","loadedmetadata","loadstart","pause","play","waiting","resize","progress","posterready","durationchange","seeked","seeking","timeupdate","volumechange"],e.METHODS={setter_getter:["buffered","bufferedEnd","bufferedPercent","controls","currentSrc","currentTime","currentType","duration","ended","isFullscreen","language","muted","paused","playbackRate","poster","remainingTime","volume"],setter_only:["dispose","exitFullscreen","play","pause","load","src"]},e.init=function(t){var r;e.player=t,e.queue=[],e.el=$("<div></div"),e.player.options.is_iframe=window!==top?!0:!1,e.enablePostMessageApi()&&(r=new VHX.Player.Api.postMessage(e)),e.isIframeParent()&&(e.method_storage={},setInterval(function(){e.storeMethods()},750)),e.createMethods()},e.public_methods.ready=function(){e.runAndFlushQueue(),e.setupEvents()},e.enablePostMessageApi=function(){return e.isIframePlayer()||e.isIframeParent()},e.isIframePlayer=function(){return e.player.options.is_iframe&&e.isIframeApiEnabled(window.location.search)&&e.browserSupported()},e.isIframeParent=function(){return"IFRAME"===$("#"+e.player.options.id).prop("tagName")&&e.isIframeApiEnabled($("#"+e.player.options.id).prop("src"))&&e.browserSupported()},e.browserSupported=function(){var e,t,r;return e=document.createElement("div").innerHTML="<!--[if IE 8]>true<![endif]-->",t="true"===e.innerHTML,r=!!window.postMessage,!t&&r?!0:!1},e.isIframeApiEnabled=function(e){return-1!==e.indexOf("api=1")},e.createMethods=function(){var t=e.METHODS.setter_getter.concat(e.METHODS.setter_only);$.each(t,function(t,r){e.public_methods[r]=function(){if("function"==typeof e.sendPostmessage&&e.isIframeParent()&&(e.sendPostmessage(r,arguments),"undefined"!=typeof e.method_storage[r]&&0===arguments.length))return e.method_storage[r];if("undefined"!=typeof e.player.videojs&&"undefined"!=typeof e.player.videojs[r])if(e.utils.isFunction(e.method_overrides[r]))try{return e.method_overrides[r].apply(e.player.videojs,arguments)}catch(t){}else try{return e.player.videojs[r].apply(e.player.videojs,arguments)}catch(t){}else"play"===r&&e.player.handlePlayRequest(),e.queue.push({method:r,params:arguments})}})},e.method_overrides={src:function(t){var r=e.utils.createLinkParser(t).pathname;window.history.pushState&&e.utils.isPlayerUrl(t)&&window.history.pushState({},"",t),player.dispose(),player=null,$("body").removeClass("init ready").append(e.player.options.$clone),config.source={href:"https://api.vhx.tv"+r},player=new VHX.Player("video",config)}},e.public_methods.on=function(t,r){e.el.on(t,r)},e.setupEvents=function(){$.each(e.EVENTS,function(t,r){e.player.videojs.on(r,function(){switch(r){case"volumechange":e.handlePlayerEvent(r,[e.player.videojs.volume(),e.player.videojs.muted()]);break;case"durationchange":e.handlePlayerEvent(r,[e.player.videojs.duration()]);break;case"seeked":e.handlePlayerEvent(r,[e.player.videojs.currentTime(),e.player.videojs.duration()]);break;case"ended":var t=e.utils.isFunction(e.player.videojs.isCasting)&&e.player.videojs.isCasting()?!0:!1,o="undefined"==typeof e.player.videojs.currentTime()||e.player.videojs.currentTime()<5?!0:!1;t&&o||e.handlePlayerEvent(r);break;case"seeking":e.handlePlayerEvent(r,[e.player.videojs.currentTime(),e.player.videojs.duration()]);break;case"timeupdate":e.handlePlayerEvent(r,[e.player.videojs.currentTime(),e.player.videojs.duration()]);break;default:e.handlePlayerEvent(r)}})})},e.handlePlayerEvent=function(t,r){"function"==typeof e.sendPostmessage&&e.isIframePlayer()?e.sendPostmessage(t,r):e.el.trigger(t,r)},e.runAndFlushQueue=function(){e.queue.length>0&&$.each(e.queue,function(t,r){"undefined"!=typeof e.public_methods[r.method]&&e.public_methods[r.method].apply(e.player.videojs,r.params)}),e.queue=[]},e.storeMethods=function(){$.each(e.METHODS.setter_getter,function(t,r){e.sendPostmessage(r,"")})},e.init.apply(e,arguments),e.public_methods.trigger=e.handlePlayerEvent,e.public_methods},VHX.Player.Api.postMessage=function(e){var t=e;t.options={iframe_origin:null},t.init=function(){t.player.options.is_iframe?t.setListener("iframe"):(t.iframe_el=$("#"+t.player.options.id),t.getOrigin(),t.setListener("parent"))},t.getOrigin=function(){var e=t.iframe_el.prop("src"),r=t.utils.createLinkParser(e);t.options.iframe_origin=r.protocol+"//"+r.hostname},t.setListener=function(e){var r=window.addEventListener?"addEventListener":"attachEvent",o=window[r],a="attachEvent"===r?"onmessage":"message";e+="Handler",o(a,function(r){t[e](r)},!1)},t.iframeHandler=function(e){var r,o,a;doc_referrer=t.getReferrer(),doc_referrer&&(r=t.utils.createLinkParser(doc_referrer),e.origin===r.origin&&(o=JSON.parse(e.data),o.params="undefined"!=typeof o.params?t.utils.parseParams(o.params):[],t.utils.isFunction(t.public_methods[o.method])&&(a=t.public_methods[o.method].apply(t.player.videojs,o.params),t.sendMethodResponseToParent(o,a))))},t.parentHandler=function(e){var r;e.origin===t.options.iframe_origin&&(r=JSON.parse(e.data),"response"===r.method?t.storeMethodResponse(r):t.triggerEvent(r))},t.sendPostmessage=function(e,r){var o,a;doc_referrer=t.getReferrer(),"response"!==e?r="undefined"!=typeof r?t.utils.stringifyParams(r):"":t.utils.isSubObj(r.response)&&(r.response=""),a=JSON.stringify({method:e,params:r}),t.player.options.is_iframe&&doc_referrer?(o=t.utils.createLinkParser(doc_referrer),o&&parent.postMessage(a,o.origin)):"undefined"!=typeof t.iframe_el&&t.iframe_el.length&&t.options.iframe_origin&&t.iframe_el[0].contentWindow.postMessage(a,t.options.iframe_origin)},t.sendMethodResponseToParent=function(e,r){var o={method:e.method,response:r};-1===t.METHODS.setter_getter.indexOf(e.method)&&(o={method:e.method}),t.sendPostmessage("response",o)},t.storeMethodResponse=function(e){t.METHODS.setter_getter.indexOf(e.params.method)>=0&&(t.method_storage[e.params.method]=e.params.response)},t.getReferrer=function(){try{if(t.requiresStoredReferrer()){var e=window.localStorage.vhx_cast_referrer;return e}}catch(r){}return document.referrer},t.requiresStoredReferrer=function(){return"undefined"==typeof window.localStorage.vhx_cast_referrer?!1:document.referrer.match(/embed.crystal.dev|embed.vhx.tv/)?!0:!1},t.triggerEvent=function(e){e.params="undefined"!=typeof e.params?t.utils.parseParams(e.params):[],t.el.trigger(e.method,e.params)},t.init()};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.Oauth=function(){var e=this;return e.options={},e.init=function(t,r){return e.options=t,e.callback=r,e.parser=document.createElement("a"),e.parser.href=e.getApiHref(),e.options.credentials.access_token?e.callback(e.options.credentials):void $.ajax({url:e.parser.protocol+"//"+e.parser.host+"/oauth/token",type:"POST",data:{client_id:e.options.credentials.client_id,client_secret:e.options.credentials.client_secret,grant_type:"client_credentials"},crossDomain:!0}).done(function(t){e.options.credentials.access_token=t.access_token,e.callback(e.options.credentials)}).fail(function(){e.callback(e.options.credentials)})},e.getApiHref=function(){return e.options.href.match(/vhx.tv/)?"https://api.vhx.tv":e.options.href.match(/vhxorbeta.com/)?"https://api.vhxorbeta.com":e.options.href.match(/crystal.dev/)?"http://api.crystal.dev":void 0},e.init.apply(e,arguments),{}};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.Source=function(){var e=this;return e.options={},e.cache={},e.user_id=null,e.init=function(t,r){return e.options=t.source||{},e.options.autoplay=t.autoplay,e.options.credentials=t.credentials,e.video_html=t.video_html,e.callback=r,e.browser=VHX.Player.Utils.getBrowserInfo(),e.options.href.match(/vimeo\.com|youtu\.be|youtube\.com/i)?(e.source=e.options.href,e.createVideo(),e.callback(e.instance())):void new VHX.Player.Oauth(e.options,function(t){e.options.credentials.access_token=t.access_token,VHX.Player.authCallback?VHX.Player.authCallback():e.fetchResource()})},e.load=function(t){return e.options.autoplay=!0,e.callback=t,e.isVimeo()||e.isYoutube()?e.callback(e.instance()):void e.fetchResource()},e.fetchResource=function(){return e.isTrailer()?e.fetchProduct(e.options.href):void e.fetchVideo(e.options.href)},e.isTrailer=function(){return!!e.options.href.match(/\/packages\//i)||!!e.options.href.match(/\/subscriptions\//i)},e.isTVOD=function(){return!!e.options.href.match(/\/packages\//i)},e.isSVOD=function(){return!!e.options.href.match(/\/subscriptions\//i)},e.fetchProduct=function(t){$.when(e.apiRequest(t)).done(function(t){return e.product=t,e.setPlayerData(t),e.options.autoplay&&t._embedded.trailer?e.fetchVideo(t._embedded.trailer._links.self.href):(t._embedded.trailer||(e.source=t.trailer_url,e.createVideo()),void e.callback(e.instance()))}).fail(function(){e.callback()})},e.fetchVideo=function(t){var r=e.options.autoplay?$.when(e.apiRequest(t),e.apiRequest(t+"/files")):$.when(e.apiRequest(t));r.done(function(t,r){e.video=t,e.setPlayerData(t),"object"==typeof r&&(e.setSource(r),-1===e.browser.name.indexOf("IE")&&e.setTracks(t._embedded.subtitles)),e.callback(e.instance())}).fail(function(){e.callback()})},e.apiRequest=function(t){var r=$.Deferred(),o={url:t,type:"GET",headers:{Authorization:"Bearer "+e.options.credentials.access_token},data:{},crossDomain:!0,xhrFields:{withCredentials:!0}};return(!$.support.cors||window.XDomainRequest)&&(o.data.access_token=e.options.credentials.access_token,o.data.session=e.options.credentials.session),t.match(/\/files/i)&&(o.cache=!1,e.options.credentials.authorization&&(o.data.authorization=e.options.credentials.authorization),e.options.credentials.ticket&&(o.data.ticket=e.options.credentials.ticket)),e.cache[t]?r.resolve(e.cache[t]):$.ajax(o).done(function(o,a,n){e.cache[t]=o,n.getResponseHeader("x-user-id")&&(e.user_id=parseInt(n.getResponseHeader("x-user-id"))),r.resolve(o)}).fail(function(){r.reject()}),r},e.setPlayerData=function(t){if(e.data||(document.title=t.title+" on VHX",e.data={poster:t.thumbnail.large+"?"+window.location.origin.replace(":/","_"),color:t._embedded.site.color,title:t.title,homepage:t._embedded.site._links.home_page.href,"twitter-handle":t._embedded.site.twitter_name,"trailer-embed":t.trailer_embed_code}),t._links.self.href.match(/\/videos\//i))e.data["video-id"]=t.id;else{if(e.data["poster-blurred"]=t.thumbnail.blurred,e.options.buy_action=t.rental?"rent":"buy",e.isSVOD()&&(e.options.buy_action=t.price.monthly?"monthly":"yearly"),VHX.Player.Utils.getQueryParam("buy_action")){var r=VHX.Player.Utils.getQueryParam("buy_action"),o=!1;e.isTVOD()&&"buy"==r&&t.price&&(o=!0),e.isTVOD()&&"rent"==r&&t.rental&&(o=!0),e.isSVOD()&&"monthly"==r&&t.price.monthly&&(o=!0),e.isSVOD()&&"yearly"==r&&t.price.yearly&&(o=!0),o&&(e.options.buy_action=r)}t.is_active&&(e.data["is-trailer"]=!0,e.data["purchase-href"]=e.setPurchaseLink(t),e.data["purchase-label"]=e.setPurchaseLabel(t),e.data["purchase-price"]=e.setPurchasePrice(t))}e.data["user-id"]=e.user_id},e.setPurchaseLink=function(t){var r=e.setCouponCode();return"buy"==e.options.buy_action?t._links.buy_page.href+"?purchase=1"+(r?"&"+r:""):"yearly"==e.options.buy_action?t._links.buy_page.href+"?plan=yearly"+(r?"&"+r:""):t._links.buy_page.href+(r?"?"+r:"")},e.setCouponCode=function(){return VHX.Player.Utils.getQueryParam("code")?"code="+VHX.Player.Utils.getQueryParam("code"):!1},e.setPurchaseLabel=function(t){return VHX.Player.Utils.getQueryParam("buy_label")?VHX.Player.Utils.getQueryParam("buy_label"):t.is_preorder?"Pre-Order":t.rental&&"rent"==e.options.buy_action?"Rent":e.isTVOD()?"Buy":"Subscribe"},e.setPurchasePrice=function(t){return VHX.Player.Utils.getQueryParam("show_price")&&0==VHX.Player.Utils.getQueryParam("show_price")?"":"yearly"==e.options.buy_action?t.price.yearly.formatted:"monthly"==e.options.buy_action?t.price.monthly.formatted:"rent"==e.options.buy_action?t.rental.price[e.options.country]?t.rental.price[e.options.country].formatted:t.rental.price.formatted:t.price[e.options.country]?t.price[e.options.country].formatted:t.price.formatted},e.setSource=function(t){var r,o=[],a="";$.each(t,function(t,n){e.isValidFile(n)&&(r=e.getResolution(n),a+='<source src="'+n._links.source.href+'" type="'+n.mime_type+'"',null!==r.quality&&(a+=' data-res="'+r.label+'" data-quality="'+r.quality+'"',o.push(r.quality)),a+=">")}),e.video_html=e.video_html+a+"</video>",e.createVideo(),o=o.push(window.innerHeight)&&o.sort(function(e,t){return e-t}),e.$video.find('source[data-quality="'+(o[o.indexOf(window.innerHeight)-1]||o[1])+'"]').attr("data-default",!0)},e.isValidFile=function(e){return"application/x-mpegURL"===e.mime_type&&Modernizr.android?!1:!0},e.setTracks=function(t){var r;$.each(t,function(t,o){"srt"===o.type&&(r=o._links.self.href,r=r.replace("https://dr56wvhu2c8zo.cloudfront.net","https://track.vhx.tv").replace(".srt",".vtt"),e.$video.append('<track src="'+r+'" label="'+o.language+'" kind="subtitles" srclang=""></track>'))})},e.createVideo=function(){e.$video=$(e.video_html),e.data&&$.each(e.data,function(t,r){e.$video.attr("data-"+t,r)})},e.getResolution=function(e){switch(parseInt(e.quality)){case 1080:return{label:"Best <var>1080p</var>",quality:1080};case 720:return{label:"High <var>720p</var>",quality:720};case 540:return{label:"Medium <var>540p</var>",quality:540};case 480:return{label:"Low <var>480p</var>",quality:480};case 360:return{label:"Low <var>360p</var>",quality:360}}return{label:e.quality,quality:null}},e.isVimeo=function(){return e.source&&!!e.source.match(/vimeo.com/i)},e.isYoutube=function(){return e.source&&!!e.source.match(/youtube.com|youtu.be/i)},e.instance=function(){return{init:function(t,r){return e.init(t,r)},load:function(t){return e.load(t)},isDrmEnabled:function(){return e.video&&e.video.is_drm_enabled},isTrailer:function(){return e.isTrailer()},isTrailerWithoutVideo:function(){return e.isTrailer()&&!e.product._embedded.trailer&&!e.source},isVimeo:function(){return e.isVimeo()},isYoutube:function(){return e.isYoutube()},getSource:function(){return e.source},getVideo:function(){return e.$video},getData:function(t){return e.data?e.data[t]:null},hasError:function(){return e.isVimeo()||e.isYoutube()?!1:!e.options.autoplay||e.$video&&0!==e.$video.find("source").length?!e.video&&!e.product:!0}}},e.instance()};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.DRM=function(){var e=this;return e.options={widevineLicenseServerURL:"https://lic.drmtoday.com/license-proxy-widevine/cenc/",accessLicenseServerURL:"https://lic.drmtoday.com/flashaccess/LicenseTrigger/v1",merchant:"castlabsvhx",techs:["dashjs","dashas"],licenseRequestTimeout:5e3,manifestRequestTimeout:5e3,ABRParameters:{downloadRatioSafetyFactor:1.5,qualitySwitchThreshold:2e3,bandwidthSafetyFactor:1.5,minBufferLength:8,maxBufferLength:15,liveDelay:2}},e.init=function(t){e.options=videojs.util.mergeOptions(e.options,{assetId:t.$video.attr("data-video-id"),customData:{userId:t.$video.attr("data-user-id"),sessionId:t.credentials.device,merchant:e.options.merchant},flashFile:t.flash.drm}),t.$video.attr("data-is-drm",!0)},e.isEnabled=function(){return e.options.assetId&&e.options.customData.userId&&e.options.customData.sessionId},e.init.apply(e,arguments),{isEnabled:function(){return e.isEnabled()},getConfig:function(){return e.options}}};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.SiteColor=function(e){var t=this;return t.init=function(){var r=VHX.Player.Utils.getQueryParam("color"),o={lumonisity_pass:!0,hex:r?"#"+r:e.color};return"dark"!==VHX.Player.Utils.getHexBrightness(o.hex)&&o.hex?t.writeStyles(o.hex):o.lumonisity_pass=!1,o},t.writeStyles=function(e){e&&$("<style>"+t.getStyles(e)+"</style>").appendTo("head")},t.getStyles=function(e){return".vjs-default-skin { color: "+e+";}.vjs-default-skin .vjs-volume-level, .vjs-default-skin .vjs-play-progress { background: "+e+";}.vjs-default-skin .vjs-back-link:before { color: "+e+";}.vjs-default-skin .vjs-back-link:link, .vjs-default-skin .vjs-back-link:visited, .vjs-default-skin .vjs-back-link:active { color: "+e+";}.vjs-default-skin .vjs-btn:link, .vjs-default-skin .vjs-btn:visited { border: 1px solid "+e+";}.poster .vjs-btn:link, .poster .vjs-btn:visited { border: 1px solid "+e+";}.touch .poster:after { border-color: "+e+";}"},t.init()};var VHX=VHX||{};VHX.Player=VHX.Player||{},VHX.Player.BuyWidget=function(e){var t=this;return t.utils=VHX.Player.Utils,t.defaults={enabled:!0},t.options=$.extend({},t.defaults,e),t.init=function(){t.options.connection_established=!1,t.setPostMessageListener()},t.isEnabled=function(){return t.options.enabled&&t.options.connection_established},t.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},t.sendMessage=function(e){if(e.frame&&e.obj){var t=JSON.stringify(e.obj);e.frame.postMessage(t,e.url)}},t.setPostMessageListener=function(){var e=window.addEventListener?"addEventListener":"attachEvent",r=window[e],o="attachEvent"===e?"onmessage":"message";r(o,t.postMessageHandler,!1)},t.postMessageHandler=function(e){if(document.referrer){var r=t.utils.createLinkParser(document.referrer);e.origin===r.origin&&"string"==typeof e.data&&(t.data=JSON.parse(e.data),t.data.method&&t.isFunction(t[t.data.method])&&t[t.data.method](t.data.params))}},t.bindButton=function(){t.options.connection_established=!0,t.sendMessage({frame:parent,obj:{method:"embedConnectionEstablished",params:{}},url:document.referrer})},t.openWidget=function(e){try{t.sendMessage({frame:parent,obj:{method:"openWidgetFromEmbed",params:{href:e}},url:document.referrer})}catch(r){}},t.options.enabled&&t.init(),{isEnabled:t.isEnabled,open:t.openWidget,sendMessage:t.sendMessage}};
